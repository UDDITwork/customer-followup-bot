# Customer Quote Request Management System

An automated system for processing customer laptop quote request emails, extracting information using Claude AI, and managing follow-up communications.

## Features

- ğŸ¤– **AI-Powered Extraction**: Uses Claude API to extract quote details from unstructured emails
- ğŸ“§ **Dual Email Modes**:
  - **Local Development**: Mock email system (no actual emails sent)
  - **Production**: Resend API integration
- ğŸ« **Smart Ticket Management**: Automatically creates tickets and tracks status
- ğŸ”„ **Automated Follow-ups**: Generates personalized follow-up emails for missing information
- ğŸ“Š **Dashboard**: React-based UI to view and manage all quote requests
- â˜ï¸ **Cloud-Ready**: Designed for Google Cloud Run deployment

## Tech Stack

### Backend
- **FastAPI** - Modern Python web framework
- **Turso (LibSQL)** - Serverless SQLite database
- **Claude API** - AI for email extraction and response generation
- **Resend** - Email API for production

### Frontend
- **React** with Vite
- **Tailwind CSS** - Utility-first styling
- **React Query** - Server state management
- **React Router** - Navigation

## Project Structure

```
customer-followup/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ config.py          # Environment configuration
â”‚   â”‚   â”œâ”€â”€ database.py        # Turso connection & schema
â”‚   â”‚   â”œâ”€â”€ main.py            # FastAPI application
â”‚   â”‚   â”œâ”€â”€ models/            # Pydantic models
â”‚   â”‚   â”œâ”€â”€ routers/           # API endpoints
â”‚   â”‚   â””â”€â”€ services/          # Business logic
â”‚   â”œâ”€â”€ requirements.txt       # Python dependencies
â”‚   â”œâ”€â”€ Procfile               # Cloud Run config
â”‚   â””â”€â”€ .env.local            # Local dev environment
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ pages/            # React pages
â”‚   â”‚   â”œâ”€â”€ services/         # API client
â”‚   â”‚   â””â”€â”€ App.jsx
â”‚   â””â”€â”€ package.json
â””â”€â”€ README.md
```

---

## ğŸš€ Local Development Setup

### Prerequisites

- **Python 3.10+**
- **Node.js 18+**
- **npm or yarn**

### Backend Setup

1. **Navigate to backend directory:**
   ```bash
   cd backend
   ```

2. **Create and activate virtual environment:**
   ```bash
   python -m venv venv

   # Windows
   venv\\Scripts\\activate

   # Mac/Linux
   source venv/bin/activate
   ```

3. **Install dependencies:**
   ```bash
   pip install -r requirements.txt
   ```

4. **Environment is already configured:**
   - `.env.local` is already set up with your credentials
   - Turso database URL and token are configured
   - Claude API key is set
   - Running in LOCAL mode (mock emails)

5. **Initialize database:**
   ```bash
   python -m app.database
   ```

6. **Start the backend server:**
   ```bash
   uvicorn app.main:app --reload
   ```

   The API will be available at: **http://localhost:8000**

   API docs at: **http://localhost:8000/docs**

### Frontend Setup

1. **Navigate to frontend directory:**
   ```bash
   cd frontend
   ```

2. **Install dependencies:**
   ```bash
   npm install
   ```

3. **Start development server:**
   ```bash
   npm run dev
   ```

   The frontend will be available at: **http://localhost:5173**

---

## ğŸ§ª Testing the System Locally

### Method 1: Using FastAPI Docs (Easiest)

1. Open **http://localhost:8000/docs**
2. Find the `/dev/receive-email` endpoint
3. Click "Try it out"
4. Paste this test email:

   ```json
   {
     "from_email": "john.smith@example.com",
     "subject": "Quote Request for Dell Laptops",
     "body": "Hi,\n\nI need a quote for Dell Latitude 5430 laptops.\n\nDetails:\n- Model: Dell Latitude 5430\n- RAM: 16GB\n- Storage: 512GB SSD\n- Screen: 14-inch FHD\n- Warranty: 3-year\n- Quantity: 25 units\n- Delivery: 123 Main St, New York, NY 10001\n- Timeline: Need by March 15, 2026\n\nBest regards,\nJohn Smith"
   }
   ```

5. Click "Execute"
6. Check the response - you'll see a ticket was created
7. Open **http://localhost:5173** to see the ticket in the dashboard!

### Method 2: Using curl

```bash
# Send a test email
curl -X POST http://localhost:8000/dev/receive-email \
  -H "Content-Type: application/json" \
  -d '{
    "from_email": "test@example.com",
    "subject": "Need laptop quote",
    "body": "Hi, I need 10 laptops for my office. Can you send me a quote?"
  }'

# View all tickets
curl http://localhost:8000/tickets/

# View mock sent emails (follow-ups generated by system)
curl http://localhost:8000/dev/sent-emails
```

### Method 3: Using Python

```python
import requests

# Simulate receiving an email
response = requests.post('http://localhost:8000/dev/receive-email', json={
    "from_email": "customer@company.com",
    "subject": "Quote for laptops",
    "body": "I need laptops with 16GB RAM. Please quote."
})
print(response.json())

# View tickets
tickets = requests.get('http://localhost:8000/tickets/').json()
print(f"Total tickets: {len(tickets)}")

# View sent emails
sent = requests.get('http://localhost:8000/dev/sent-emails').json()
print(f"Sent emails: {sent['count']}")
```

---

## ğŸ“§ Test Email Examples

See [backend/test_emails.md](backend/test_emails.md) for complete test examples.

### Quick Tests:

**1. Complete Information (should create READY ticket):**
```json
{
  "from_email": "john@example.com",
  "subject": "Quote Request",
  "body": "Dell Latitude 5430, 16GB RAM, 512GB SSD, 14-inch, 3-year warranty, 25 units, NYC, March 15, 2026"
}
```

**2. Missing Information (should send follow-up):**
```json
{
  "from_email": "sarah@company.com",
  "subject": "Laptop quote needed",
  "body": "I need HP EliteBook with 16GB RAM."
}
```

**3. Simulate Reply (use ticket ID from previous response):**
```json
{
  "from_email": "sarah@company.com",
  "subject": "Re: Laptop quote needed",
  "body": "Storage: 512GB SSD, Quantity: 10 units, Delivery: Chicago",
  "in_reply_to": 1
}
```

---

## ğŸ“‹ API Endpoints

### Tickets
- `GET /tickets/` - List all tickets (optional `?status=NEW` filter)
- `GET /tickets/{id}` - Get ticket details
- `PATCH /tickets/{id}` - Update ticket
- `POST /tickets/{id}/send-email` - Send manual follow-up

### Development Endpoints (local mode only)
- `POST /dev/receive-email` - Simulate incoming email
- `GET /dev/sent-emails` - View mock sent emails
- `DELETE /dev/sent-emails` - Clear mock emails

### Production Endpoints
- `POST /webhooks/resend` - Resend webhook for incoming emails

---

## ğŸ¯ How It Works

### 1. Email Processing Flow

```
Incoming Email
    â†“
Claude extracts: customer name, email, laptop specs, quantity, etc.
    â†“
Create Ticket in Turso database
    â†“
Check if all required fields present
    â†“
If missing â†’ Generate follow-up email with Claude â†’ Send via Resend (or mock)
If complete â†’ Mark ticket as READY
```

### 2. Reply Handling

```
Customer Reply
    â†“
Match to existing ticket
    â†“
Re-extract data from full email thread
    â†“
Update ticket with new information
    â†“
Still missing? â†’ Send another follow-up
Complete? â†’ Mark as READY
```

### 3. Required Fields

A ticket is marked **READY** when all these fields are present:
- Customer name
- Customer email
- Laptop model
- RAM
- Storage
- Screen size
- Warranty
- Quantity
- Delivery location
- Delivery timeline

**Budget** is optional.

---

## ğŸŒ Production Deployment

### Prerequisites
- Google Cloud account with Cloud Run enabled
- Domain configured in Resend for receiving emails

### Deployment Steps

1. **Update `.env.production`** with your production values:
   - `RESEND_FROM_EMAIL=sales@yourdomain.com`
   - `FRONTEND_URL=https://your-frontend.vercel.app`

2. **Deploy Backend to Cloud Run:**
   ```bash
   gcloud run deploy customer-followup-api \
     --source ./backend \
     --platform managed \
     --region us-central1 \
     --allow-unauthenticated \
     --set-env-vars ENVIRONMENT=production
   ```

3. **Configure Resend Webhook:**
   - Go to Resend dashboard
   - Add webhook URL: `https://your-backend-url.run.app/webhooks/resend`
   - Select event: `email.received`

4. **Deploy Frontend to Vercel:**
   - Connect your GitHub repo to Vercel
   - Set root directory: `frontend`
   - Set environment variable: `VITE_API_URL=<your-cloud-run-url>`
   - Deploy

---

## ğŸ› Troubleshooting

### Backend won't start
- Check if port 8000 is already in use
- Verify virtual environment is activated
- Ensure `.env.local` exists with correct credentials

### Frontend won't start
- Run `npm install` in frontend directory
- Check if port 5173 is available
- Verify `.env` file exists with `VITE_API_URL`

### Database errors
- Run `python -m app.database` to reinitialize schema
- Check Turso credentials in `.env.local`

### No tickets appearing
- Check backend logs for errors
- Verify API is running at http://localhost:8000
- Test with `/docs` endpoint
- Check browser console for frontend errors

---

## ğŸ“š Additional Resources

- **FastAPI Docs**: http://localhost:8000/docs
- **Turso Dashboard**: https://turso.tech
- **Claude API Docs**: https://docs.anthropic.com
- **Resend Docs**: https://resend.com/docs

---

## ğŸ› ï¸ Development Tips

### Viewing Mock Emails
In local mode, all "sent" emails are stored in the database:
```bash
curl http://localhost:8000/dev/sent-emails
```

### Clearing Test Data
```bash
# Clear mock emails
curl -X DELETE http://localhost:8000/dev/sent-emails

# Clear database (reinitialize)
cd backend
python -m app.database
```

### Testing Claude Extraction
Send various email formats to see how Claude extracts the data:
- Well-formatted with bullet points
- Unstructured paragraphs
- Minimal information
- Complete information

---

## ğŸ“ License

MIT

---

## ğŸ’¬ Support

For issues or questions, please create an issue in the GitHub repository.

---

**Built with â¤ï¸ using FastAPI, React, Claude AI, and Turso**
